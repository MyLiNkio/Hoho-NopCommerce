@* !!! It is improtant to understand that it doesn't correspond to the EU Low.
But we work for clients from Georgia so, it is create only to cover requirements of Google Tag Manager for consent mode.
SO, in case of changing Law in Georgia, it makes sence to remove that logic
and connect a CPM solution like CookieYes or CookieBot etc... *@

<script asp-location="Head">
    // Create dataLayer before GTM is loaded
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }

    // Consent type constants
    const AD_STORAGE = 'ad_storage';
    const ANALYTICS_STORAGE = 'analytics_storage';
    const AD_USER_DATA = 'ad_user_data';
    const AD_PERSONALIZATION = 'ad_personalization';
    const PERSONALIZATION_STORAGE = 'personalization_storage';
    const FUNCTIONALITY_STORAGE = 'functionality_storage';
    const SECURITY_STORAGE = 'security_storage';

    // Cookie helper functions
    function setCookie(name, value, days = 365) {
        const expires = new Date(Date.now() + days * 86400000).toUTCString();
        document.cookie = `${name}=${value}; path=/; expires=${expires}; SameSite=Lax`;
    }

    function getCookie(name) {
        const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        return match ? match[2] : undefined;
    }

    // Send consent to Google Tag Manager
    function setConsentInGTM(action) {
        const consent = {};
        consent[AD_STORAGE] = getCookie(AD_STORAGE) || 'denied';
        consent[ANALYTICS_STORAGE] = getCookie(ANALYTICS_STORAGE) || 'denied';
        consent[AD_USER_DATA] = getCookie(AD_USER_DATA) || 'denied';
        consent[AD_PERSONALIZATION] = getCookie(AD_PERSONALIZATION) || 'denied';
        consent[PERSONALIZATION_STORAGE] = getCookie(PERSONALIZATION_STORAGE) || 'denied';
        consent[FUNCTIONALITY_STORAGE] = 'granted';
        consent[SECURITY_STORAGE] = 'granted';

        if (typeof gtag === 'function') {
            gtag('consent', action, consent);
        } else {
            console.warn("gtag function is not declared");
        }
    }

    // Wait for GTM to be ready before applying consent
    (function () {
        function onGTMReady(callback) {
            for (let i = 0; i < dataLayer.length; i++) {
                if (dataLayer[i].event === 'gtm.js') {
                    callback();
                    return;
                }
            }

            const originalPush = dataLayer.push;
            dataLayer.push = function () {
                for (let i = 0; i < arguments.length; i++) {
                    if (arguments[i].event === 'gtm.js') {
                        callback();
                    }
                }
                return originalPush.apply(dataLayer, arguments);
            };
        }

        onGTMReady(function () {
            setConsentInGTM('default');
        });
    })();
</script>

<script asp-location="Footer">
    document.addEventListener('DOMContentLoaded', function () {
        const banner = document.getElementById('eu-cookie-bar-notification');
        const okButton = document.getElementById('eu-cookie-ok');

        const hasConsent = getCookie(AD_STORAGE) ||
                           getCookie(ANALYTICS_STORAGE) ||
                           getCookie(AD_USER_DATA) ||
                           getCookie(AD_PERSONALIZATION) ||
                           getCookie(PERSONALIZATION_STORAGE) ||
                           getCookie(FUNCTIONALITY_STORAGE) ||
                           getCookie(SECURITY_STORAGE);

        if (!hasConsent) {
            banner.style.display = 'block';
        }

        okButton.addEventListener('click', function () {
            banner.style.display = 'none';
            setCookie(AD_STORAGE, 'granted');
            setCookie(ANALYTICS_STORAGE, 'granted');
            setCookie(AD_USER_DATA, 'granted');
            setCookie(AD_PERSONALIZATION, 'granted');
            setCookie(PERSONALIZATION_STORAGE, 'granted');
            setCookie(FUNCTIONALITY_STORAGE, 'granted');
            setCookie(SECURITY_STORAGE, 'granted');

            setConsentInGTM('update');
        });
    });
</script>


<div id="eu-cookie-bar-notification" class="eu-cookie-bar-notification" style="display: none;">
    <div class="content">
        <div class="text">@T("EUCookieLaw.Description2")</div>
        <div class="buttons-more">
            <button type="button" class="ok-button button-1" id="eu-cookie-ok">@T("Common.OK")</button>
            <a class="learn-more" href="@Url.RouteTopicUrl("privacyinfo")">@T("EUCookieLaw.LearnMore")</a>
        </div>
    </div>
</div>